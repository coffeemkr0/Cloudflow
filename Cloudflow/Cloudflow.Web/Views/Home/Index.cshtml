@model Cloudflow.Web.ViewModels.Home.IndexViewModel

@{
    ViewBag.Title = "Home Page";
}

<script>
    function SetStatusText(machineName) {
        var statusText = "Unreachable";
        $.ajax({
            url: "http://" + machineName + "/CloudflowAgentService/GetAgentStatus",
            type: "GET",
            crossDomain: true,
            data: "",
            dataType: "json",
            success: function (result) {
                switch (result.Status) {
                    case 1:
                        statusText = "Idle";
                }
            },
            error: function (jqXHR, textStatus, errorThrown) {

            },
            complete: function () {
                $("#agentStatus-" + machineName).text(statusText);
            }
        });
    }
</script>



<div class="jumbotron">
    <h1>Cloudflow</h1>
</div>

<div class="row">
    <div class="col-md-12">
        <div class="panel panel-default">
            <div class="panel-heading">
                <h3 class="panel-title">Agents</h3>
            </div>
            <div class="panel-body">
                <p>
                    Use this section to control your agents. 
                </p>
                <p>
                    Use the Add button to add new agents to the list. Use the Edit or Delete button to modify existing agents in the list.
                    You can see what each agent is currently working on by viewing its Status.
                    You can also start and stop agents here.
                </p>
            </div>
            <table class="table table-striped table-bordered">
                <tr>
                    <th>Enabled</th>
                    <th>Machine Name</th>
                    <th>Status</th>
                    <th></th>
                    <th></th>
                </tr>
                @foreach (var agent in Model.AgentConfigurations)
                {
                    <tr>
                        <td>@agent.Enabled.ToString()</td>
                        <td>@agent.MachineName</td>
                        <td>
                            <a href="#" id="agentStatus-@agent.MachineName">
                            <script>
                                SetStatusText("@agent.MachineName");
                            </script>
                            </a>
                        </td>
                        <td><a href="@Url.Action("Edit", new { id = agent.Id })">Edit</a></td>
                        <td><a href="@Url.Action("Delete", new { id = agent.Id })">Delete</a></td>
                    </tr>
                }
            </table>

        </div>
    </div>
</div>